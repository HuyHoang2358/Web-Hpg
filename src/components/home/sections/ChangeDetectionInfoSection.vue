<template>
  <div class="flex flex-row">
    <div
      class="flex flex-col bg-[#151515] border border-solid rounded-sm border-[#2F2F2F] bg-opacity-90 container-section overflow-auto"
    >
      <HeaderSection
        :on-close="() => mapToolStore.changeActiveTool()"
        title="Change Detection Result"
        is-not-show-divider
      />
      <div class="p-4">
        <div
          class="border-[3px] border-solid border-[#A5A5A5] relative"
          style="width: 272px; height: 146px"
        >
          <a-image
            :width="266"
            :src="`${minio_domain}${layerStore.featurePropertiesChangeDetection?.scene_image || ''}?v=2`"
            style="object-fit: fill; width: 266px; height: 140px"
            alt="marker"
          />

          <div
            class="absolute"
            style="bottom: -3px"
            v-if="isDetectChange"
          >
            <svg
              width="65"
              height="19"
              viewBox="0 0 65 19"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M0 0H53.1416C55.1021 0 56.8817 1.14575 57.6932 2.93041L65 19H0V0Z"
                fill="white"
              />
              <path
                d="M15.1307 12H14.1989L16.2926 6.18182H17.3068L19.4006 12H18.4688L16.8239 7.23864H16.7784L15.1307 12ZM15.2869 9.72159H18.3097V10.4602H15.2869V9.72159ZM22.2259 7.63636V8.31818H19.7599V7.63636H22.2259ZM20.4361 12V7.13068C20.4361 6.85795 20.4957 6.63163 20.6151 6.4517C20.7344 6.26989 20.8925 6.13447 21.0895 6.04545C21.2865 5.95455 21.5005 5.90909 21.7315 5.90909C21.902 5.90909 22.0478 5.9233 22.169 5.9517C22.2902 5.97822 22.3802 6.00284 22.4389 6.02557L22.2401 6.71307C22.2003 6.7017 22.1491 6.68845 22.0866 6.6733C22.0241 6.65625 21.9484 6.64773 21.8594 6.64773C21.6529 6.64773 21.5052 6.69886 21.4162 6.80114C21.3291 6.90341 21.2855 7.05114 21.2855 7.24432V12H20.4361ZM25.179 7.63636V8.31818H22.7131V7.63636H25.179ZM23.3892 12V7.13068C23.3892 6.85795 23.4489 6.63163 23.5682 6.4517C23.6875 6.26989 23.8456 6.13447 24.0426 6.04545C24.2396 5.95455 24.4536 5.90909 24.6847 5.90909C24.8551 5.90909 25.0009 5.9233 25.1222 5.9517C25.2434 5.97822 25.3333 6.00284 25.392 6.02557L25.1932 6.71307C25.1534 6.7017 25.1023 6.68845 25.0398 6.6733C24.9773 6.65625 24.9015 6.64773 24.8125 6.64773C24.6061 6.64773 24.4583 6.69886 24.3693 6.80114C24.2822 6.90341 24.2386 7.05114 24.2386 7.24432V12H23.3892ZM28.0923 7.63636V8.31818H25.7088V7.63636H28.0923ZM26.348 6.59091H27.1974V10.7188C27.1974 10.8835 27.2221 11.0076 27.2713 11.0909C27.3205 11.1723 27.384 11.2282 27.4616 11.2585C27.5412 11.2869 27.6274 11.3011 27.7202 11.3011C27.7884 11.3011 27.848 11.2964 27.8991 11.2869C27.9503 11.2775 27.9901 11.2699 28.0185 11.2642L28.1719 11.9659C28.1226 11.9848 28.0526 12.0038 27.9616 12.0227C27.8707 12.0436 27.7571 12.0549 27.6207 12.0568C27.3973 12.0606 27.1889 12.0208 26.9957 11.9375C26.8026 11.8542 26.6463 11.7254 26.527 11.5511C26.4077 11.3769 26.348 11.1581 26.348 10.8949V6.59091ZM30.8658 12.0881C30.4358 12.0881 30.0656 11.9962 29.755 11.8125C29.4463 11.6269 29.2076 11.3665 29.0391 11.0312C28.8724 10.6941 28.7891 10.2992 28.7891 9.84659C28.7891 9.39962 28.8724 9.00568 29.0391 8.66477C29.2076 8.32386 29.4425 8.05777 29.7436 7.86648C30.0466 7.67519 30.4008 7.57955 30.8061 7.57955C31.0523 7.57955 31.291 7.62027 31.522 7.7017C31.7531 7.78314 31.9605 7.91098 32.1442 8.08523C32.3279 8.25947 32.4728 8.4858 32.5788 8.7642C32.6849 9.04072 32.7379 9.37689 32.7379 9.77273V10.0739H29.2692V9.4375H31.9055C31.9055 9.21402 31.8601 9.0161 31.7692 8.84375C31.6783 8.66951 31.5504 8.5322 31.3857 8.43182C31.2228 8.33144 31.0315 8.28125 30.8118 8.28125C30.5732 8.28125 30.3648 8.33996 30.1868 8.45739C30.0107 8.57292 29.8743 8.72443 29.7777 8.91193C29.683 9.09754 29.6357 9.29924 29.6357 9.51705V10.0142C29.6357 10.3059 29.6868 10.554 29.7891 10.7585C29.8932 10.9631 30.0381 11.1193 30.2237 11.2273C30.4093 11.3333 30.6262 11.3864 30.8743 11.3864C31.0353 11.3864 31.1821 11.3636 31.3146 11.3182C31.4472 11.2708 31.5618 11.2008 31.6584 11.108C31.755 11.0152 31.8288 10.9006 31.88 10.7642L32.6839 10.9091C32.6196 11.1458 32.504 11.3532 32.3374 11.5312C32.1726 11.7074 31.9652 11.8447 31.7152 11.9432C31.4671 12.0398 31.1839 12.0881 30.8658 12.0881ZM33.6804 12V7.63636H34.5014V8.32955H34.5469C34.6264 8.0947 34.7666 7.91004 34.9673 7.77557C35.17 7.6392 35.3991 7.57102 35.6548 7.57102C35.7079 7.57102 35.7704 7.57292 35.8423 7.5767C35.9162 7.58049 35.974 7.58523 36.0156 7.59091V8.40341C35.9815 8.39394 35.9209 8.38352 35.8338 8.37216C35.7467 8.3589 35.6596 8.35227 35.5724 8.35227C35.3717 8.35227 35.1927 8.39489 35.0355 8.48011C34.8802 8.56345 34.7571 8.67992 34.6662 8.82955C34.5753 8.97727 34.5298 9.14583 34.5298 9.33523V12H33.6804Z"
                fill="#EE0033"
              />
            </svg>
          </div>
          <div
            class="absolute"
            style="left: 134px; bottom: -3px"
            v-if="isDetectChange"
          >
            <svg
              width="65"
              height="19"
              viewBox="0 0 65 19"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M0 0H53.1416C55.1021 0 56.8817 1.14575 57.6932 2.93041L65 19H0V0Z"
                fill="white"
              />
              <path
                d="M11.6392 12V6.18182H13.7699C14.1828 6.18182 14.5246 6.25 14.7955 6.38636C15.0663 6.52083 15.2689 6.7036 15.4034 6.93466C15.5379 7.16383 15.6051 7.42235 15.6051 7.71023C15.6051 7.95265 15.5606 8.1572 15.4716 8.32386C15.3826 8.48864 15.2633 8.62121 15.1136 8.72159C14.9659 8.82008 14.803 8.89205 14.625 8.9375V8.99432C14.8182 9.00379 15.0066 9.06629 15.1903 9.18182C15.3759 9.29545 15.5294 9.45739 15.6506 9.66761C15.7718 9.87784 15.8324 10.1335 15.8324 10.4347C15.8324 10.732 15.7623 10.9991 15.6222 11.2358C15.4839 11.4706 15.2699 11.6572 14.9801 11.7955C14.6903 11.9318 14.3201 12 13.8693 12H11.6392ZM12.517 11.2472H13.7841C14.2045 11.2472 14.5057 11.1657 14.6875 11.0028C14.8693 10.84 14.9602 10.6364 14.9602 10.392C14.9602 10.2083 14.9138 10.0398 14.821 9.88636C14.7282 9.73295 14.5956 9.6108 14.4233 9.51989C14.2528 9.42898 14.0502 9.38352 13.8153 9.38352H12.517V11.2472ZM12.517 8.69886H13.6932C13.8902 8.69886 14.0672 8.66098 14.2244 8.58523C14.3835 8.50947 14.5095 8.40341 14.6023 8.26705C14.697 8.12879 14.7443 7.96591 14.7443 7.77841C14.7443 7.53788 14.66 7.33617 14.4915 7.1733C14.3229 7.01042 14.0644 6.92898 13.7159 6.92898H12.517V8.69886ZM18.6861 12.0881C18.2562 12.0881 17.8859 11.9962 17.5753 11.8125C17.2666 11.6269 17.0279 11.3665 16.8594 11.0312C16.6927 10.6941 16.6094 10.2992 16.6094 9.84659C16.6094 9.39962 16.6927 9.00568 16.8594 8.66477C17.0279 8.32386 17.2628 8.05777 17.5639 7.86648C17.867 7.67519 18.2211 7.57955 18.6264 7.57955C18.8726 7.57955 19.1113 7.62027 19.3423 7.7017C19.5734 7.78314 19.7808 7.91098 19.9645 8.08523C20.1482 8.25947 20.2931 8.4858 20.3991 8.7642C20.5052 9.04072 20.5582 9.37689 20.5582 9.77273V10.0739H17.0895V9.4375H19.7259C19.7259 9.21402 19.6804 9.0161 19.5895 8.84375C19.4986 8.66951 19.3707 8.5322 19.206 8.43182C19.0431 8.33144 18.8518 8.28125 18.6321 8.28125C18.3935 8.28125 18.1851 8.33996 18.0071 8.45739C17.831 8.57292 17.6946 8.72443 17.598 8.91193C17.5033 9.09754 17.456 9.29924 17.456 9.51705V10.0142C17.456 10.3059 17.5071 10.554 17.6094 10.7585C17.7135 10.9631 17.8584 11.1193 18.044 11.2273C18.2296 11.3333 18.4465 11.3864 18.6946 11.3864C18.8556 11.3864 19.0024 11.3636 19.1349 11.3182C19.2675 11.2708 19.3821 11.2008 19.4787 11.108C19.5753 11.0152 19.6491 10.9006 19.7003 10.7642L20.5043 10.9091C20.4399 11.1458 20.3243 11.3532 20.1577 11.5312C19.9929 11.7074 19.7855 11.8447 19.5355 11.9432C19.2874 12.0398 19.0043 12.0881 18.6861 12.0881ZM23.5774 7.63636V8.31818H21.1115V7.63636H23.5774ZM21.7876 12V7.13068C21.7876 6.85795 21.8473 6.63163 21.9666 6.4517C22.0859 6.26989 22.2441 6.13447 22.4411 6.04545C22.638 5.95455 22.852 5.90909 23.0831 5.90909C23.2536 5.90909 23.3994 5.9233 23.5206 5.9517C23.6418 5.97822 23.7318 6.00284 23.7905 6.02557L23.5916 6.71307C23.5518 6.7017 23.5007 6.68845 23.4382 6.6733C23.3757 6.65625 23.3 6.64773 23.2109 6.64773C23.0045 6.64773 22.8568 6.69886 22.7678 6.80114C22.6806 6.90341 22.6371 7.05114 22.6371 7.24432V12H21.7876ZM26.12 12.0881C25.7109 12.0881 25.3539 11.9943 25.049 11.8068C24.7441 11.6193 24.5073 11.357 24.3388 11.0199C24.1702 10.6828 24.0859 10.2888 24.0859 9.83807C24.0859 9.38542 24.1702 8.98958 24.3388 8.65057C24.5073 8.31155 24.7441 8.0483 25.049 7.8608C25.3539 7.6733 25.7109 7.57955 26.12 7.57955C26.5291 7.57955 26.8861 7.6733 27.1911 7.8608C27.496 8.0483 27.7327 8.31155 27.9013 8.65057C28.0698 8.98958 28.1541 9.38542 28.1541 9.83807C28.1541 10.2888 28.0698 10.6828 27.9013 11.0199C27.7327 11.357 27.496 11.6193 27.1911 11.8068C26.8861 11.9943 26.5291 12.0881 26.12 12.0881ZM26.1229 11.375C26.388 11.375 26.6077 11.3049 26.782 11.1648C26.9562 11.0246 27.085 10.8381 27.1683 10.6051C27.2536 10.3722 27.2962 10.1155 27.2962 9.83523C27.2962 9.55682 27.2536 9.30114 27.1683 9.06818C27.085 8.83333 26.9562 8.64489 26.782 8.50284C26.6077 8.3608 26.388 8.28977 26.1229 8.28977C25.8558 8.28977 25.6342 8.3608 25.4581 8.50284C25.2839 8.64489 25.1541 8.83333 25.0689 9.06818C24.9856 9.30114 24.9439 9.55682 24.9439 9.83523C24.9439 10.1155 24.9856 10.3722 25.0689 10.6051C25.1541 10.8381 25.2839 11.0246 25.4581 11.1648C25.6342 11.3049 25.8558 11.375 26.1229 11.375ZM29.1023 12V7.63636H29.9233V8.32955H29.9688C30.0483 8.0947 30.1884 7.91004 30.3892 7.77557C30.5919 7.6392 30.821 7.57102 31.0767 7.57102C31.1297 7.57102 31.1922 7.57292 31.2642 7.5767C31.3381 7.58049 31.3958 7.58523 31.4375 7.59091V8.40341C31.4034 8.39394 31.3428 8.38352 31.2557 8.37216C31.1686 8.3589 31.0814 8.35227 30.9943 8.35227C30.7936 8.35227 30.6146 8.39489 30.4574 8.48011C30.3021 8.56345 30.179 8.67992 30.0881 8.82955C29.9972 8.97727 29.9517 9.14583 29.9517 9.33523V12H29.1023ZM33.897 12.0881C33.4671 12.0881 33.0968 11.9962 32.7862 11.8125C32.4775 11.6269 32.2389 11.3665 32.0703 11.0312C31.9036 10.6941 31.8203 10.2992 31.8203 9.84659C31.8203 9.39962 31.9036 9.00568 32.0703 8.66477C32.2389 8.32386 32.4737 8.05777 32.7749 7.86648C33.0779 7.67519 33.4321 7.57955 33.8374 7.57955C34.0836 7.57955 34.3222 7.62027 34.5533 7.7017C34.7843 7.78314 34.9917 7.91098 35.1754 8.08523C35.3591 8.25947 35.504 8.4858 35.6101 8.7642C35.7161 9.04072 35.7692 9.37689 35.7692 9.77273V10.0739H32.3004V9.4375H34.9368C34.9368 9.21402 34.8913 9.0161 34.8004 8.84375C34.7095 8.66951 34.5817 8.5322 34.4169 8.43182C34.254 8.33144 34.0627 8.28125 33.843 8.28125C33.6044 8.28125 33.3961 8.33996 33.218 8.45739C33.0419 8.57292 32.9055 8.72443 32.8089 8.91193C32.7143 9.09754 32.6669 9.29924 32.6669 9.51705V10.0142C32.6669 10.3059 32.718 10.554 32.8203 10.7585C32.9245 10.9631 33.0694 11.1193 33.255 11.2273C33.4406 11.3333 33.6574 11.3864 33.9055 11.3864C34.0665 11.3864 34.2133 11.3636 34.3459 11.3182C34.4785 11.2708 34.593 11.2008 34.6896 11.108C34.7862 11.0152 34.8601 10.9006 34.9112 10.7642L35.7152 10.9091C35.6508 11.1458 35.5353 11.3532 35.3686 11.5312C35.2038 11.7074 34.9964 11.8447 34.7464 11.9432C34.4983 12.0398 34.2152 12.0881 33.897 12.0881Z"
                fill="#EE0033"
              />
            </svg>
          </div>
        </div>
        <a-descriptions
          :labelStyle="{
            fontSize: '12px',
            fontWeight: '500',
            color: 'white',
          }"
          :contentStyle="{
            fontSize: '12px',
            fontWeight: '500',
            color: 'white',
          }"
          class="mt-1"
        >
          <a-descriptions-item
            :label="t('home.infoBox.detectType')"
            class="font-sarabun font-medium text-xs xl:text-sm 2xl:text-base"
            v-if="layerStore.featurePropertiesChangeDetection?.change_type"
          >
            {{ layerStore.featurePropertiesChangeDetection?.change_type || '' }}
          </a-descriptions-item>

          <a-descriptions-item
            label="Object Type"
            class="font-sarabun font-medium text-xs xl:text-sm 2xl:text-base"
            v-if="layerStore.featurePropertiesChangeDetection?.object_type"
          >
            {{ layerStore.featurePropertiesChangeDetection?.object_type || '' }}
          </a-descriptions-item>
        </a-descriptions>
        <div class="text-white mb-2">
          <div class="flex flex-row items-center">
            <IconLocation />
            <div>
              <p class="m-0 font-sarabun font-normal text-xs xl:text-sm 2xl:text-base pl-2.5">
                {{ t('home.infoBox.location') }}:
                <span class="font-medium">
                  {{ layerStore.featurePropertiesChangeDetection?.commune || '' }}
                </span>
              </p>
            </div>
          </div>
        </div>

        <div class="border-0 border-t border-t-[#474747] border-dashed pt-3 mt-4}">
          <a-descriptions
            :column="1"
            size="small"
            :labelStyle="{
              fontSize: '12px',
              fontWeight: '500',
              color: 'white',
            }"
            :contentStyle="{
              fontSize: '12px',
              fontWeight: '500',
              color: 'white',
            }"
          >
            <a-descriptions-item
              :label="t('home.infoBox.coordinate')"
              v-if="
                layerStore.featurePropertiesChangeDetection?.latitude &&
                layerStore.featurePropertiesChangeDetection?.longitude
              "
            >
              {{
                convertCoordinates(
                  Number(layerStore.featurePropertiesChangeDetection?.latitude),
                  Number(layerStore.featurePropertiesChangeDetection?.longitude),
                )
              }}
            </a-descriptions-item>
            <a-descriptions-item
              :label="t('home.infoBox.changeArea')"
              class="text-right"
            >
              {{ layerStore.featurePropertiesChangeDetection?.area || '' }} m2
            </a-descriptions-item>
            <a-descriptions-item :label="t('home.infoBox.discoveryTime')">
              {{ layerStore.featurePropertiesChangeDetection?.time_period_after || '' }}
            </a-descriptions-item>
          </a-descriptions>
        </div>
      </div>
    </div>
  </div>
</template>
<script setup lang="ts">
import { useLayerStore } from '@/stores/LayerStore';
import HeaderSection from '@/components/home/sections/HeaderSection.vue';
import { useMapToolStore } from '@/stores/mapTool';
import IconLocation from '@/components/icons/home/IconLocation.vue';

const layerStore = useLayerStore();
const mapToolStore = useMapToolStore();
const minio_domain = import.meta.env.VITE_MINIO_DOMAIN;
import { useI18n } from 'vue-i18n';
import { convertCoordinates } from '@/DTP_new/libs/common';
import { computed } from 'vue';
const { t } = useI18n();

const isDetectChange = computed(() => layerStore.featurePropertiesChangeDetection?.change_type);
</script>
